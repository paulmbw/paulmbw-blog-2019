{"componentChunkName":"component---src-templates-post-template-jsx","path":"/posts/react-hooks-use-effect/","webpackCompilationHash":"","result":{"data":{"site":{"siteMetadata":{"title":"Paul Waweru","subtitle":"Software Engineer. I love to travel, eat and read (sometimes all at once). North London is Red. Navigating through this thing called life.","copyright":"¬© Paul Waweru 2019.","author":{"name":"Paul Waweru"},"disqusShortname":"http://paulmbw.me.uk","url":"https://lumen.netlify.com"}},"markdownRemark":{"id":"1d020dfa-f37b-5160-a1ef-dd755d15da19","html":"<p><strong>Goal</strong></p>\n<p>As with any other post, today‚Äôs goal is to clearly define <code class=\"language-text\">useEffect</code>, identify its use case and provide a basic example of its use. <strong>Warning:</strong> this will be a lengthy post with a few more detailed code examples, so please bear with! Don‚Äôt hesitate to grab a cup of tea, or a glass of whiskey, whatever tickles your fancy.</p>\n<p>Last week, we touched on the topic of <a href=\"https://paulmbw.me.uk/posts/react-hooks\">React Hooks</a> where I introduced this new feature in React, some motivations behind the idea and a simple example of their use. Today, I hope to dig a little further into this, outlining another hook called <code class=\"language-text\">useEffect</code> which essentially allows us to expand on our stateful functional components through performing <em>side effects</em> (these usually happen in lifecycle methods such as  <code class=\"language-text\">componentDidMount</code>), all whilst avoiding having to write a <em>class</em>.</p>\n<p><strong>Recap</strong></p>\n<p>The whole idea of hooks is to allow us to continue our functional approach to writing apps in React  while utilizing the full features of the framework. We introduced <code class=\"language-text\">useState</code> which is a hook for attaching functional components to some sort of internal state. However, what if we want trigger operations such as interacting with a database, or perhaps, make a HTTP request to retrieve some data? Typically, we would have our already defined <em>class</em> and would appropriately make use of the available component lifecycle methods (for the sake of brevity you can read more about these methods <a href=\"https://reactjs.org/docs/state-and-lifecycle.html#adding-lifecycle-methods-to-a-class\">here</a>). Now, we‚Äôre going to use <code class=\"language-text\">useEffect</code>, another hook allowing use to perform these operations all inside our functional component. </p>\n<p><strong>Implementation</strong></p>\n<p>Let‚Äôs take a quick glance of the <code class=\"language-text\">useEffect</code> hook:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'RENDERING!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>It‚Äôs important to note that this method gets called after each and every render (quite similar to <code class=\"language-text\">componentDidMount</code> or <code class=\"language-text\">componentDidUpdate</code>). Let‚Äôs integrate this with our <code class=\"language-text\">Library</code> functional component from last week‚Äôs post, and let‚Äôs observe the behavior:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useState<span class=\"token punctuation\">,</span> useRef<span class=\"token punctuation\">,</span> useEffect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Library</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>books<span class=\"token punctuation\">,</span> setBooks<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> inputElement <span class=\"token operator\">=</span> <span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">onSubmit</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    event<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">setBooks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>books<span class=\"token punctuation\">,</span> inputElement<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'RENDERING!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">...</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><img src=\"/04ceda348821d157e5eb5090b3eb7707/addBook.gif\" alt=\"Alt Text\"></p>\n<p>As you can see, whenever we press the Add Book button, the <code class=\"language-text\">Library</code> component is re-rendered and our <code class=\"language-text\">console.log(&#39;RENDERING&#39;</code>) appears. </p>\n<p><strong>Pause!</strong></p>\n<p>Okay, let‚Äôs recap a little. What has happened so far? We‚Äôve defined <code class=\"language-text\">useEffect</code> as another example of a hook (in addition to <code class=\"language-text\">useState</code>), and the clear distinction between the two is the former allows us to perform side effects (so, operations such as database access or API requests) which would have otherwise been implemented in a class using lifecycle methods. Still with me? Let‚Äôs improve our <code class=\"language-text\">Library</code> component to do something more useful, such as making a <code class=\"language-text\">GET</code> request to list all the books from my favorite author <a href=\"http://www.matthaig.com\">Matt Haig</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useState<span class=\"token punctuation\">,</span> useEffect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> axios <span class=\"token keyword\">from</span> <span class=\"token string\">'axios'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Library</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// like before, we are 'hooking' our component to state</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>books<span class=\"token punctuation\">,</span> setBooks<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// we now want to perform a side effect through calling an endpoint</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">axios</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://www.googleapis.com/books/v1/volumes?q=matt+haig'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// response is an array of book titles, so we want to update our state </span>\n    <span class=\"token function\">setBooks</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> item<span class=\"token punctuation\">.</span>volumeInfo<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">\"library\"</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n        <span class=\"token punctuation\">{</span>books <span class=\"token operator\">&amp;&amp;</span>\n          books<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">book<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n            <span class=\"token operator\">&lt;</span>li key<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>index<span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>book<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span>\n          <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bcdc77debcdb5af5b36f2c7efe429d38/beee6/listBooks.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 39.69907407407407%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAArElEQVQoz52R2wqDMBBE/f9fCxgfoiKCKF4gCkoiBkTjlA20WGktzbwMuyyHYTbARcdxvHzfd+fPHc3W2re7q4JvwHVd0fc9mqZBVVUoigJt28IY4wckH8cRSZIgyzLEcYyu6/wSnlOWZYkwDBFFEZZluYXdAimJUgp5noNzDiEEpJTYts2/w2EYXHeMMaRpirquobX2A5LmeXZQSkYPmqbJffov4K+Ozh1/0gNxMXKJHbqIcwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Alt Text\"\n        title=\"\"\n        src=\"/static/bcdc77debcdb5af5b36f2c7efe429d38/f570d/listBooks.png\"\n        srcset=\"/static/bcdc77debcdb5af5b36f2c7efe429d38/0783d/listBooks.png 240w,\n/static/bcdc77debcdb5af5b36f2c7efe429d38/782f4/listBooks.png 480w,\n/static/bcdc77debcdb5af5b36f2c7efe429d38/f570d/listBooks.png 960w,\n/static/bcdc77debcdb5af5b36f2c7efe429d38/8d0ff/listBooks.png 1440w,\n/static/bcdc77debcdb5af5b36f2c7efe429d38/beee6/listBooks.png 1728w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Awesome! We have a list of books written by Mr Haig, however, we have an enormous problem that‚Äôs raging inside of our console logs:</p>\n<p><img src=\"/f680d90d07a2675dc93765695b735c6c/mess.gif\" alt=\"Alt Text\"></p>\n<p><strong>What‚Äôs wrong? ü§∑üèæ‚Äç‚ôÇÔ∏è</strong></p>\n<p>Casting back to our initial understanding of <code class=\"language-text\">useEffect</code>, we learned that this method is invoked after every render. So, when our effect is performed (that is, when we fetch our list of books), our <em>state is updated</em> with a new list of books, which consequently re-renders our component and triggers our <code class=\"language-text\">useEffect</code> again; we‚Äôre now in an infinite loop!</p>\n<p>We can avoid this infinite loop by passing a second parameter to the <code class=\"language-text\">useEffect</code> method which is an array of two items:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// HTTP request implementation</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>value<span class=\"token punctuation\">,</span> hook<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">axios</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://www.googleapis.com/books/v1/volumes?q=peter+swanson'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">setData</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> item<span class=\"token punctuation\">.</span>volumeInfo<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span>url<span class=\"token punctuation\">,</span> setData<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </code></pre></div>\n<p>This is telling React to watch the value of <code class=\"language-text\">url</code>, and <strong>only</strong> call the <code class=\"language-text\">setData</code> hook when this value changes. In the following example, we are changing the <code class=\"language-text\">url</code> parameter, which will then invoke our <code class=\"language-text\">setData</code> to fetch the new list of books, finally updating the state; note that this flow only happens when we change the value of <code class=\"language-text\">url</code>:</p>\n<p><img src=\"/76633b7a186e8dce99a53d7712a94693/nomess.gif\" alt=\"Alt Text\"></p>\n<p><strong>Okay, can we recap again?</strong></p>\n<p>Sure! Let‚Äôs go through it again. We now know what <code class=\"language-text\">useEffect</code> does, and hopefully we understand why we need to use it in this case. However, we ran into the problem of indefinitely updating our component because our hook is called after every re-render, which updates the state, triggering a re-render, which calls our effect again‚Ä¶so on so fourth. To solve this, we pass one more parameter (an array containing a value and an effect) to our hook which tells React to only re-run our effect when a value changes. </p>\n<p><strong>Note: using componentWillUnmount with useEffect</strong></p>\n<p>The <code class=\"language-text\">componentWillUnmount</code> lifecycle method can also be performed with <code class=\"language-text\">useEffect</code> through returning a callback function like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"> <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n   <span class=\"token comment\">// we want to subscribe to an author so we know when he/she releases a new book!</span>\n    BooksAPI<span class=\"token punctuation\">.</span><span class=\"token function\">subscribeToAuthor</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>authorName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token comment\">// Specify how to clean up after this effect:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      BooksAPI<span class=\"token punctuation\">.</span><span class=\"token function\">unsubscribeFromAuthor</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>authorName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>Conclusion</strong></p>\n<p>That was pretty long, wasn‚Äôt it?! Hopefully I did a decent job at demystifying <code class=\"language-text\">useEffect</code>and its use cases. In all honesty, all these updates from React did take some time to understand, but  breaking things down and using simple examples helped with writing up today‚Äôs post. Hope you enjoyed reading, and stay tuned for more posts coming soon! üïµüèæ‚Äç‚ôÇÔ∏è</p>","fields":{"tagSlugs":["/tags/learning/","/tags/react/"]},"frontmatter":{"title":"React Hooks (Continued)","tags":["learning","react"],"date":"2019-01-26T23:46:37.121Z","description":"As promised, today we take a look into useEffect, another hook used for managing side effects."}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/posts/react-hooks-use-effect/"}}}